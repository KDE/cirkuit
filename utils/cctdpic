#!/bin/bash
TMPNAME=tempA1R2C3W4i5e6r6d7
CIRCUIT_MACROS_PATH=/home/agostine/.kde/share/apps/cirkuit/circuit_macros

function mkltx()
{
cat > $TMPNAME.tex << EOF
\documentclass{article}
\usepackage{pstricks,pst-eps,boxdims,graphicx,ifpdf,pst-grad}
\pagestyle{empty}
\thispagestyle{empty}
\begin{document}
\newbox\graph
\begin{TeXtoEPS}
\input $TMPNAME.cct 
\box
\graph
\end{TeXtoEPS}
\end{document}
EOF
return
}

filpath=`dirname $1`
fn=$filpath/`basename $1 .m4`
if [ -e $fn.m4 ]
then
m4 $CIRCUIT_MACROS_PATH/pstricks.m4 $CIRCUIT_MACROS_PATH/libcct.m4 $fn.m4 | dpic -p > $TMPNAME.cct
if [ ! -e $TMPNAME.tex ]
then mkltx
fi
cp $TMPNAME.cct $fn.pst
latex $TMPNAME.tex -output-format=dvi
dvips -Ppdf -G0 -E $TMPNAME -o $fn.eps
convert -density 200 $fn.eps $fn.png
#dvips -Ppdf -G0 -O 1in,1in -Pcmz -Pamz $TMPNAME -o $fn.ps
#ps2eps -l -f $fn.ps

#epstopdf $fn.eps
#epstopdf -d --nogs $fn.eps>$fn.ps

rm -f $TMPNAME.*
else
echo "$fn.m4 does not exist!"
fi
